---
layout: default
---

<link rel="stylesheet" href="https://unpkg.com/@primer/css@^19.0.0/dist/primer.css" />

<div class="my-6">
  <div class="my-5 d-flex flex-justify-between">
    <label for="vid">Vendor ID <input class="mx-2 form-control" type="text" name="vid" id="vid" /></label>
    <label for="pid">Product ID <input class="mx-2 form-control" type="text" name="pid" id="pid" /></label>
    <button class="px-2 btn btn-primary" type="button" onclick="getDevices()">Connect</button>
  </div>

  <form class="my-5">
    <div class="input-group">
      <input class="form-control" type="text" placeholder="Data" aria-label="Data" />
      <span class="input-group-button">
        <button class="btn" type="button" aria-label="Send data to device">Send</button>
      </span>
    </div>
  </form>

  <pre class="m-5 border" id="status">Connect a USB Device</pre>
</div>

<script>
  console.log('Started WebUSB Debug!');
  const LogUI = document.getElementById('status');

  const _devices = [];

  async function getDevices() {
    LogUI.innerText = 'Connecting...\n';

    try {
      const vid = document.getElementById('vid').value;
      const pid = document.getElementById('pid').value;

      const device = await navigator.usb.requestDevice({
        filters: [
          {
            vendorId: vid ? Number.parseInt(vid, 16) : undefined,
            productId: pid ? Number.parseInt(pid, 16) : undefined,
          },
        ],
      });

      attachDevice(device);
    } catch (e) {
      LogUI.innerText = 'No device selected.\n';
      console.log(e);
    }
  }

  async function attachDevice(device) {
    console.log(device);
    if (!device) return;

    await device.open();
    if (device.configuration === null) await device.selectConfiguration(1);

    console.log('device trying to attach', device);

    _devices.push(device);

    LogUI.innerText += `Connected: ${device.manufacturerName} ${device.productName}\n`;
    LogUI.innerText += `Vendor ID: 0x${device.vendorId.toString(16).toUpperCase()}\n`;
    LogUI.innerText += `Product ID: 0x${device.productId.toString(16).toUpperCase()}\n`;
    LogUI.innerText += `Serial Number: ${device.serialNumber}\n`;
    LogUI.innerText += `Device Version: ${device.deviceVersionMajor}.${device.deviceVersionMinor}.${device.deviceVersionSubminor}\n`;
    LogUI.innerText += `USB Version: ${device.usbVersionMajor}.${device.usbVersionMinor}.${device.usbVersionSubminor}\n`;

    // - configerations
    //   - interfaces
    //     - alternates
    //       - endpoints

    LogUI.innerText += `\nConfigurations:\n${device.configurations
      .map(
        (cnfg) =>
          `  - ${cnfg.configurationValue}: ${cnfg.configurationName} ${device.configuration.configurationValue == cnfg.configurationValue ? '*' : ''}\n` +
          cnfg.interfaces
            .map(
              (intf) =>
                `    - interface ${intf.interfaceNumber} ${intf.claimed ? '(claimed)' : ''}\n` +
                intf.alternates
                  .map(
                    (alt) =>
                      `      - alt: setting ${alt.alternateSetting} / interface { name: ${alt.interfaceName}, proto: ${alt.interfaceProtocol}, class: ${alt.interfaceClass}.${alt.interfaceSubclass} }\n` +
                      alt.endpoints.map((ep) => `        - endpoint ${ep.endpointNumber}: ${ep.type} ${ep.direction} ${ep.packetSize}b`).join('\n')
                  )
                  .join('\n')
            )
            .join('\n')
      )
      .join('')}\n`;
    return;
  }
</script>
