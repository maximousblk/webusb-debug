---
layout: default
---

<link rel="stylesheet" href="https://unpkg.com/@primer/css@^19.0.0/dist/primer.css" />

<div class="my-3">
  <div class="p-5 d-flex flex-justify-between">
    <label for="vid">Vendor ID</label>
    <input type="text" name="vid" id="vid" />
    <label for="pid">Product ID</label>
    <input type="text" name="pid" id="pid" />
  </div>
  <button class="px-2 btn btn-primary" type="button" onclick="getDevices()">Connect</button>

  <pre class="my-3 anim-fade-in border v-hidden" id="status"></pre>
</div>

<script>
  console.log('Started WebUSB Debug!');

  const _devices = [];

  async function getDevices() {
    document.getElementById('status').innerText = '';
    document.getElementById('status').classList.remove('v-hidden');
    document.getElementById('status').innerText = 'Connecting...\n';

    try {
      const vid = document.getElementById('vid').value;
      const pid = document.getElementById('pid').value;

      const device = await navigator.usb.requestDevice({
        filters: [
          {
            vendorId: vid ? Number.parseInt(vid, 16) : undefined,
            productId: pid ? Number.parseInt(pid, 16) : undefined,
          },
        ],
      });

      attachDevice(device);
    } catch (e) {
      document.getElementById('status').innerText = 'No device selected.\n';
      console.log(e);
    }
  }

  async function attachDevice(device) {
    console.log(device);
    if (!device) return;

    await device.open();
    if (device.configuration === null) await device.selectConfiguration(1);

    console.log('device trying to attach', device);

    _devices.push(device);

    document.getElementById('status').innerText += `Attached: ${device.manufacturerName} ${device.productName}\n`;
    document.getElementById('status').innerText += `Vendor ID: 0x${device.vendorId.toString(16)}\n`;
    document.getElementById('status').innerText += `Product ID: 0x${device.productId.toString(16)}\n`;
    document.getElementById('status').innerText += `Serial Number: 0x${device.serialNumber.toString(16)}\n`;
    document.getElementById('status').innerText += `Device Version: ${device.deviceVersionMajor}.${device.deviceVersionMinor}.${device.deviceVersionSubminor}\n`;
    document.getElementById('status').innerText += `USB Version: ${device.usbVersionMajor}.${device.usbVersionMinor}.${device.usbVersionSubminor}\n`;

    return;
  }
</script>
