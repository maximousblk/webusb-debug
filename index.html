---
layout: default
---

<link rel="stylesheet" href="/assets/css/style.css" />

<div>
  <div class="p-5 d-flex flex-justify-between">
    <label for="vid">Vendor ID</label>
    <input type="text" name="vid" id="vid" />
    <label for="pid">Product ID</label>
    <input type="text" name="pid" id="pid" />
  </div>
  <button class="p-5 btn" onclick="getDevices()">Connect</button>

  <pre class="anim-fade-in anim-fade-out border v-hidden" id="status"></pre>
</div>

<script>
  console.log('Started WebUSB Debug!');

  const _devices = [];

  async function getDevices() {
    try {
      const vid = document.getElementById('vid').value;
      const pid = document.getElementById('pid').value;

      const device = await navigator.usb.requestDevice({
        filters: [
          {
            vendorId: vid ? Number.parseInt(vid, 16) : undefined,
            productId: pid ? Number.parseInt(pid, 16) : undefined,
          },
        ],
      });

      attachDevice(device);
    } catch (e) {
      // No device was selected.
      console.log(e);
    }
  }

  async function attachDevice(device) {
    console.log(device);
    if (!device) return;

    await device.open();
    if (device.configuration === null) await device.selectConfiguration(1);

    console.log('device trying to attach', device);

    _devices.push(device);
    document.getElementById('status').innerText += 'Attached: ' + device.manufacturerName + ' ' + device.productName;
    document.getElementById('status').classList.remove('v-hidden');
    document.getElementById('status').innerText += JSON.stringify(device, null, 2);
    return;
  }
</script>
